## Face recognition with TensorRT C++
### Requirements
- C++ TensorRT
- OpenCV
- Cublas
- Sqlite3
- [Crow](https://github.com/CrowCpp/Crow)

## Usage
### Build and run app server
```bash
$ mkdir build && cd build && cmake ..
$ make -j12
$ ./app -c ../src/config.json
```

### Test api with curl
insert face to database
```bash
$ curl localhost:18080/insert/user -d '{"userId": "cc", "userName": "CC"}'
$ curl localhost:18080/insert/face -d '{"data": [{"userId": "cc", "imgPath": "./path/to/image/joey1.ppm"}]}'
```

### Test face matching with user input via api `/recognize`
```bash
$ cd build/src/test
$ ./test_client
```

### Get `embeding.json` file for Deepstream config
Embedding json file is generated by function `exportToJson()` defined in `db.cpp` if `gen_database` is enabled in `config.json`

## Benchmark
    - device: laptop - GeForce RTX 3060 Mobile / Max-Q
    - inference ~100 faces (detect face in full frame) into database `/insert/face` api: <br/>
    (2022-12-31 04:19:19) [INFO    ] total time: 6957ms <br/>
    (2022-12-31 04:19:19) [INFO    ] total embeddings: 103 ids

    - test 1 cropped face `/recognize` api: <br/>
    (2022-12-31 04:25:36) [INFO    ] time: 17ms <br/>
    (2022-12-31 04:25:36) [INFO    ] Response: 0x55bba9eb5710 /recognize 200 0

